<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reboard">

	<!-- 리스트 가져오기 -->
	<select id="getList" parameterType="String" resultType="com.javaex.vo.ReplyBoardVo">
		<![CDATA[
			select  r.no,
			        r.user_no,
			        u.name,
			        r.title,
			        r.content,
			        r.hit,
        			to_char(r.reg_date,'yyyy-mm-dd hh24:mi') reg_date,
			        r.group_no,
			        r.order_no,
			        r.depth
			from replyboard r, users u
			where r.user_no = u.no
			and r.title like #{title}
			order by r.group_no desc, r.order_no
		]]>
	</select>

	<!-- 게시글 가져오기 -->
	<select id="getPost" parameterType="int" resultType="com.javaex.vo.ReplyBoardVo">
		<![CDATA[
			select  r.no,
			        r.user_no,
			        u.name,
			        r.title,
			        r.content,
			        r.hit,
			        to_char(r.reg_date,'yyyy-mm-dd hh24:mi') reg_date,
			        r.group_no,
			        r.order_no,
			        r.depth
			from replyboard r, users u
			where r.user_no = u.no
			and r.no = #{no}
		]]>
	</select>
	
	<!-- 게시글 등록하기 -->
	<select id="postInsert" parameterType="com.javaex.vo.ReplyBoardVo">
		<![CDATA[
			INSERT INTO replyboard
			VALUES(seq_rBoard_no.nextval, #{user_no}, #{title}, #{content}, 0, sysdate, seq_rBoard_no.nextval, 1, 1)
		]]>
	</select>
	
	<!-- 답글 등록하기 -->
	<select id="replyInsert" parameterType="com.javaex.vo.ReplyBoardVo">
		<![CDATA[
			INSERT INTO replyboard
			VALUES(seq_rBoard_no.nextval, #{user_no}, #{title}, #{content}, 0, sysdate, #{group_no}, #{order_no}, #{depth})
		]]>
	</select>
	
	<!-- order_no + 1 -->
	<update id="oNoUpdate" parameterType="com.javaex.vo.ReplyBoardVo">
		<![CDATA[
			update replyboard
			set order_no = order_no + 1
			where order_no > #{order_no}
			and group_no = #{group_no}
		]]>
	</update>
	
   <!-- 게시글 수정 -->
    <update id="update" parameterType="com.javaex.vo.ReplyBoardVo">
   		<![CDATA[
	    	update replyboard
			set title = #{title},
			    content = #{content}
			where no = #{no}
		]]>
    </update>
    
	<!-- 카운트 -->
    <update id="cnt" parameterType="int">
		<![CDATA[
	    	update replyboard
			set hit = hit + 1
			where no = #{no}
		]]>
    </update>
    
    <!-- 게시글 삭제 -->
    <delete id="delete" parameterType="map">
	    <![CDATA[
			DELETE FROM replyboard r
			WHERE no = #{no}
			AND r.user_no in (select u.no
			                  from users u
			                  where u.password = #{password})
		]]>
    </delete>
</mapper>
